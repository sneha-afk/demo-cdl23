

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Logit bias &#8212; SK Demos</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/001-logit-bias';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Redis memory connector" href="002-redis-memory.html" />
    <link rel="prev" title="Introduction" href="000-introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">SK Demos</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="000-introduction.html">Introduction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributions</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Logit bias</a></li>
<li class="toctree-l1"><a class="reference internal" href="002-redis-memory.html">Redis memory connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="003-wikipedia-connector.html">Wikipedia search connector</a></li>
<li class="toctree-l1"><a class="reference internal" href="004-data-querying.html">Data querying</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/sneha-afk/demo-cdl23" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/sneha-afk/demo-cdl23/issues/new?title=Issue%20on%20page%20%2Fnotebooks/001-logit-bias.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/001-logit-bias.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Logit bias</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="logit-bias">
<h1>Logit bias<a class="headerlink" href="#logit-bias" title="Permalink to this heading">#</a></h1>
<p>From the OpenAI API, <a class="reference external" href="https://platform.openai.com/docs/api-reference/chat/create#chat/create-logit_bias">logit bias</a> is taken as a mapping of tokens to their bias levels ranging from -100, a potential complete ban of the token, to 100, a potenital guarantee of selection. Lesser magnitude values like -1 or 1 will configure the possibility for the token’s “selection”: the chance it will appear in the output.</p>
<p>The representative tokens for certain characters can be obtained from <a class="reference external" href="https://platform.openai.com/tokenizer">OpenAI’s tokenizer</a> or through other helpful programs.</p>
<p>Tokenizers are sensitive to capitalization, spaces, and punctuation; it is crucial to consider all possible tokens of certain strings if logit bias is being implemented manually.</p>
<blockquote>
<div><p>A helpful tokenizer package to is <code class="docutils literal notranslate"><span class="pre">tiktoken</span></code>, check out the project <a class="reference external" href="https://github.com/openai/tiktoken">here</a>.</p>
</div></blockquote>
<p>As a team of three, we worked on implementing logit bias on the Python branch by adding a dictionary parameter to <code class="docutils literal notranslate"><span class="pre">ChatRequestSettings</span></code> and <code class="docutils literal notranslate"><span class="pre">CompleteRequestSettings</span></code> and including them in the JSON requests sent to the OpenAI API.</p>
<p>See our <a class="reference external" href="https://github.com/microsoft/semantic-kernel/pull/1880">merged pull request #1880</a> for the source code.</p>
<hr class="docutils" />
<p><strong>Case 1: <code class="docutils literal notranslate"><span class="pre">ChefBot</span></code></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Logit bias is part of the offical Python module</span>
<span class="o">!</span>python<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>-q<span class="w"> </span>install<span class="w"> </span>semantic-kernel
</pre></div>
</div>
</div>
</div>
<p>Imagine you are developing a <code class="docutils literal notranslate"><span class="pre">ChefBot</span></code> program that comes up with delicious recipes for a user while also keeping preferences and allergies in mind. Yum!</p>
<p>A user may ask:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>User:&gt;<span class="w"> </span>I<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>make<span class="w"> </span>a<span class="w"> </span>smoothie,<span class="w"> </span>pls<span class="w"> </span>remember<span class="w"> </span>I<span class="w"> </span>am<span class="w"> </span>allergic<span class="w"> </span>to<span class="w"> </span>bananas!
</pre></div>
</div>
<p>Gathering the tokens for “bananas” yields <code class="docutils literal notranslate"><span class="pre">[3820,</span> <span class="pre">15991]</span></code>, which should be banned from the outputted recipe.</p>
<blockquote>
<div><p>As discussed earlier, however, to completely ban the tokens would mean having different variations of the string <code class="docutils literal notranslate"><span class="pre">&quot;bananas&quot;</span></code>.
I will add these myself, but don’t be discouraged if you aren’t getting total bans at first!</p>
</div></blockquote>
<p>Let’s set up the <code class="docutils literal notranslate"><span class="pre">ChefBot</span></code> chat experience:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Required imports</span>

<span class="kn">import</span> <span class="nn">semantic_kernel</span> <span class="k">as</span> <span class="nn">sk</span>
<span class="kn">from</span> <span class="nn">semantic_kernel.connectors.ai.open_ai</span> <span class="kn">import</span> <span class="n">OpenAIChatCompletion</span>
<span class="kn">from</span> <span class="nn">semantic_kernel.connectors.ai.chat_request_settings</span> <span class="kn">import</span> <span class="n">ChatRequestSettings</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup a chat service</span>

<span class="c1"># Note: you can download this notebook and run in a directory containing a .env with your OpenAI API key,</span>
<span class="c1"># or add it manually where the &quot;key&quot; string is. Be careful with your secrets!</span>
<span class="n">USE_ENV</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">USE_ENV</span><span class="p">:</span>
    <span class="n">api_key</span><span class="p">,</span> <span class="n">org_id</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">openai_settings_from_dot_env</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">api_key</span><span class="p">,</span> <span class="n">org_id</span> <span class="o">=</span> <span class="s2">&quot;key&quot;</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># Register the chat service into the kernel</span>
<span class="n">openai_chat_completion</span> <span class="o">=</span> <span class="n">OpenAIChatCompletion</span><span class="p">(</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span> <span class="n">api_key</span><span class="p">,</span> <span class="n">org_id</span><span class="p">)</span>

<span class="c1"># Ensuring it was instantiated correctly</span>
<span class="k">assert</span> <span class="n">openai_chat_completion</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p>For more complex use with the kernel and as a semantic function, you can also register it as a skill:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">kernel</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">Kernel</span><span class="p">()</span>
<span class="n">prompt_config</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">PromptTemplateConfig</span><span class="o">.</span><span class="n">from_completion_parameters</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">top_p</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">prompt_template</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">ChatPromptTemplate</span><span class="p">(</span><span class="s2">&quot;{{$user_input}}&quot;</span><span class="p">,</span> <span class="n">kernel</span><span class="o">.</span><span class="n">prompt_template_engine</span><span class="p">,</span> <span class="n">prompt_config</span><span class="p">)</span>
<span class="n">prompt_template</span><span class="o">.</span><span class="n">add_system_message</span><span class="p">(</span><span class="s2">&quot;You are a chat bot specializing the culinary arts.&quot;</span><span class="p">)</span>
<span class="n">function_config</span> <span class="o">=</span> <span class="n">sk</span><span class="o">.</span><span class="n">SemanticFunctionConfig</span><span class="p">(</span><span class="n">prompt_config</span><span class="p">,</span> <span class="n">prompt_template</span><span class="p">)</span>
<span class="n">chat_with_chef</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">register_semantic_function</span><span class="p">(</span><span class="s2">&quot;ChefBot&quot;</span><span class="p">,</span> <span class="s2">&quot;Chat&quot;</span><span class="p">,</span> <span class="n">function_config</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>The tokens must be set with a logit bias of -100 for a total ban. This is done within the <code class="docutils literal notranslate"><span class="pre">ChatRequestSettings</span></code> instance send with the request.</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">CompleteRequestSettings</span></code> is used in text completion requests.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">ChatRequestSettings</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">top_p</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">tokens_to_ban</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3820</span><span class="p">,</span> <span class="mi">15991</span><span class="p">,</span> <span class="mi">2271</span><span class="p">,</span> <span class="mi">35484</span><span class="p">,</span> <span class="mi">25996</span><span class="p">,</span> <span class="mi">3958</span><span class="p">]</span>
<span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens_to_ban</span><span class="p">:</span>
    <span class="n">settings</span><span class="o">.</span><span class="n">token_selection_biases</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>       <span class="c1"># no monkey business</span>
</pre></div>
</div>
</div>
</div>
<p>Set up chat history and add the user’s request.</p>
<blockquote>
<div><p>In an actual program, this can be done more succinctly using <code class="docutils literal notranslate"><span class="pre">input()</span></code> and some parsing.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_request</span> <span class="o">=</span> <span class="s2">&quot;I want to make a smoothie, pls remember I am allergic to bananas!&quot;</span>

<span class="n">chat_messages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_request</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>User request in one hand, loaded settings in the other, let’s get a response!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">openai_chat_completion</span><span class="o">.</span><span class="n">complete_chat_async</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">answer</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Define a helper loop for printing out chat history:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_chat</span><span class="p">(</span><span class="n">msg_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">role</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">msg_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User:&gt; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ChefBot:&gt; </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">print_chat</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User:&gt; I want to make a smoothie, pls remember I am allergic to bananas!

ChefBot:&gt; No worries! Here&#39;s a delicious smoothie recipe that doesn&#39;t include bananas:

Ingredients:
- 1 cup of frozen berries (strawberries, blueberries, raspberries, or a mix)
- 1 cup of spinach or kale
- 1 cup of almond milk (or any other non-dairy milk of your choice)
- 1 tablespoon of honey or maple syrup (optional, for added sweetness)
- 1 tablespoon of chia seeds (optional, for added nutrition)
- Ice cubes (optional, for a colder smoothie)

Instructions:
1. Add the frozen berries, spinach or kale, almond milk, honey or maple syrup, and chia seeds to a blender.
2. Blend on high speed until smooth and creamy. If the mixture is too thick, you can add a little more almond milk to reach your desired consistency.
3. Taste the smoothie and adjust the sweetness if needed by adding more honey or maple syrup.
4. If you prefer a colder smoothie, add a few ice cubes and blend again until well combined.
5. Pour the smoothie into a glass and enjoy!

Feel free to customize this recipe by adding other fruits or ingredients that you enjoy. Enjoy your banana-free smoothie!
</pre></div>
</div>
</div>
</div>
<p>Hmm… other than the friendly assertion that the recipe does not include bananas, the response was pretty banana-less!</p>
<p>But how can you be certain it did not response as such only <em>because</em> you said you were allergic to bananas?</p>
<p>Confirm by removing it from the prompt and restarting the chat history!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_request</span> <span class="o">=</span> <span class="s2">&quot;I want to make a smoothie :)&quot;</span>

<span class="n">chat_messages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_request</span><span class="p">))</span>
<span class="n">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">openai_chat_completion</span><span class="o">.</span><span class="n">complete_chat_async</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">answer</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_chat</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User:&gt; I want to make a smoothie :)

ChefBot:&gt; Great! Making a smoothie is a fun and healthy way to enjoy a refreshing drink. Here&#39;s a simple recipe to get you started:

Ingredients:
- 1 cup of your favorite fruits (such as bananas, berries, mango, or pineapple)
- 1 cup of liquid (such as milk, almond milk, coconut water, or yogurt)
- 1 tablespoon of honey or maple syrup (optional, for added sweetness)
- 1 cup of ice cubes

Instructions:
1. Gather all your ingredients and wash the fruits if necessary.
2. Chop the fruits into smaller pieces for easier blending.
3. Add the fruits, liquid, sweetener (if using), and ice cubes to a blender.
4. Blend everything together on high speed until smooth and creamy. If the consistency is too thick, you can add more liquid.
5. Taste the smoothie and adjust the sweetness or thickness according to your preference.
6. Pour the smoothie into a glass or a portable bottle.
7. You can garnish the smoothie with a sprinkle of chia seeds, shredded coconut, or a few fresh fruit slices if desired.
8. Enjoy your homemade smoothie immediately!

Feel free to customize your smoothie by adding other ingredients like spinach or kale for extra nutrients, protein powder for a post-workout boost, or a spoonful of nut butter for added creaminess. Have fun experimenting with different flavor combinations!
</pre></div>
</div>
</div>
</div>
<p>And compare the response to the same prompt but a new settings instance while all other chat parameters are the same.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blank_settings</span> <span class="o">=</span> <span class="n">ChatRequestSettings</span><span class="p">(</span><span class="n">max_tokens</span><span class="o">=</span><span class="mi">516</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">top_p</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">chat_messages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">user_request</span><span class="p">))</span>
<span class="n">answer</span> <span class="o">=</span> <span class="k">await</span> <span class="n">openai_chat_completion</span><span class="o">.</span><span class="n">complete_chat_async</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">,</span> <span class="n">blank_settings</span><span class="p">)</span>
<span class="n">chat_messages</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;assistant&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">answer</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">print_chat</span><span class="p">(</span><span class="n">chat_messages</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User:&gt; I want to make a smoothie :)

ChefBot:&gt; Great! Making a smoothie is a fun and easy way to enjoy a nutritious and delicious drink. Here&#39;s a simple recipe to get you started:

Ingredients:
- 1 ripe banana
- 1 cup of frozen berries (such as strawberries, blueberries, or mixed berries)
- 1 cup of milk (dairy or plant-based)
- 1 tablespoon of honey or maple syrup (optional, for added sweetness)
- 1/2 cup of yogurt (optional, for a creamier texture)
- Ice cubes (optional, for a colder smoothie)

Instructions:
1. Peel the banana and break it into smaller chunks.
2. Place the banana chunks, frozen berries, milk, honey or maple syrup, and yogurt (if using) into a blender.
3. Blend all the ingredients together until smooth and creamy. If the mixture seems too thick, you can add a little more milk.
4. If you prefer a colder smoothie, you can add a few ice cubes and blend again.
5. Taste the smoothie and adjust the sweetness or thickness to your liking by adding more honey, milk, or yogurt if desired.
6. Once you&#39;re satisfied with the consistency and taste, pour the smoothie into a glass and enjoy!

Feel free to experiment with different fruits, vegetables, and add-ins like spinach, kale, peanut butter, or protein powder to customize your smoothie to your preferences. Enjoy your homemade smoothie!
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<p>Recognize that the LLM’s outputs will always have a non-deterministic aspect of it, and even with the greatest logit bias definitions, there may be banned tokens present in the output.</p>
<p>Prompt engineering is a tricky practice, and logit bias is just one tool to help.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="000-introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="002-redis-memory.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Redis memory connector</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By sneha-afk
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>